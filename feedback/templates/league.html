{% extends "base.html" %}

{% block title %}Music League | {{ league.name }}{% endblock %}

{% block content %}

<div class="container">
    <div class="row">
        <h1>{{ league.name }}</h1>

        <table>
            <tr><td>Owner:</td><td><a href="{{ url_for('view_user', user_id=league.owner.id) }}">{{ league.owner.name }}</a></td></tr>
            <tr><td>Created:</td><td>{{ league.created.strftime('%m/%d/%Y') }}</td></tr>
            <tr><td>Locked:</td><td>{{ league.locked }}</td></tr>
        </table>
    </div>

    <div class="row">

        <div class="col-md-9">

            <div class="row" style="margin: 30px 0px">
                {% if user == league.owner %}
                <a href="{{ url_for('post_create_submission_period', league_name=league.name) }}" class="btn btn-primary"><i class="fa fa-plus"></i>&nbsp;Submission Period</a>
                {% endif %}
                {% if user in league.users and league.current_submission_period %}
                <a href="{{ url_for('view_submit', league_name=league.name) }}" class="btn btn-primary"><i class="fa fa-check"></i>&nbsp;Submit</a>
                {% endif %}
            </div>

            <div class="row">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Playlist</th>
                            <th># Submissions</th>
                            <th>Complete</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for submission_period in league.submission_periods|reverse %}
                            {% if submission_period.is_current %}
                            <tr class="info">
                            {% else %}
                            <tr>
                            {% endif %}
                                <td><a href="{{ url_for('view_submission_period', league_name=league.name, submission_period_id=submission_period.id) }}">{{ submission_period.name }}</a></td>
                                <td>
                                    {% if submission_period.playlist_created %}
                                    <a href="{{ submission_period.playlist_url }}" target="_blank">Spotify</a>
                                    {% else %}
                                    Pending
                                    {% endif %}
                                </td>
                                <td>{{ submission_period.submissions|length }}</td>
                                <td>{{ submission_period.complete }}</td>
                                <td>
                                    {% if league.owner == user %}
                                    <a href="{{ url_for('remove_submission_period', league_name=league.name, submission_period_id=submission_period.id) }}">
                                        <i class="fa fa-times" aria-hidden="true" style="color: red"></i>
                                    </a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>

        <div class="col-md-3">

            {% for user in league.users %}
            <p><a href="{{ url_for('view_user', user_id=user.id) }}">{{ user.name }}</a></p>
            {% endfor %}

            <div class="row">
                <form action="{{ url_for('add_user_for_league', league_name=league.name) }}" method="post" class="form-inline">
                    <div class="control-group">
                        <input type="text" class="form-control" name="email" id="add_user" placeholder="Email or Name">
                        <button type="submit" class="btn btn-primary"><i class="fa fa-plus"></i></button>
                    </div>
                </form>
            </div>

        </div>

    </div>

</div>

{% endblock %}

{% block jq %}
<script type = "text/javascript">
    $(function() {
        $( "#add_user" ).autocomplete({
            source: function( request, response ) {
                $.ajax({
                    url: "{{ url_for('autocomplete') }}",
                    dataType: "json",
                    data: {term: request.term},
                    success: function( data ) { response( data ); }
                });
            },
            minLength: 2,
        });
    });
</script>
{% endblock %}
