{% extends "base.html" %}

{% block title %}Music League | {{ league.name }}{% endblock %}

{% block css %}
<link rel="stylesheet" href="/static/css/submit.css">
{% endblock %}

{% block content %}

<div id="img-bar" style="background-image: url('/static/images/{{ user.profile_background }}')">
    <div id="nav-bar">
        <div class="brand-wrapper">
            <a href="/">
                <img src="/static/icons/site_logo.svg" alt="" class="brand-icon">
            </a>
        </div>
        <div class="add-league-wrapper">
            <span class="add-league-text hidden-xs">Add League</span>
            <a href="{{ url_for('get_create_league') }}">
                <img src="/static/icons/add_icon.svg" alt="" class="add-league-icon">
            </a>
        </div>
        <svg class="account-divider" width="7" height="120" viewBox="0 0 3 120" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <line stroke-linecap="round" x1="1" y1="0" x2="1" y2="90" stroke="white" stroke-width="3"/>
        </svg>
        <div class="account-wrapper">
            <span class="account-name hidden-xs">{{ user.first_name }}</span>
            <div class="dropdown" style="display: inline;">
                <a type="button" class="dropdown-toggle account-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <img src="/static/icons/account_icon.svg" alt="" class="account-icon">
                </a>
                <ul class="dropdown-menu pull-right">
                    <li>
                        <a href="{{ url_for('profile') }}">
                            <span id="profile-icon" class="icon"></span>
                            <span class="text">Profile</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('view_profile_settings') }}">
                            <span id="settings-icon" class="icon"></span>
                            <span class="text">Settings</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('logout') }}">
                            <span id="logout-icon" class="icon"></span>
                            <span class="text">Log Out</span>
                        </a>
                    </li>
                    {% if user.is_admin %}
                    <li>
                        <a href="{{ url_for('admin') }}">
                            <span id="admin-icon" class="icon"></span>
                            <span class="text">Admin</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
    <div id="title-bar">
        <span class="round-title">{{ round.name }}:&nbsp;</span>
        <span class="round-action">Submitting</span>
        <span class="league-title">{{ league.name }}</span>
    </div>
</div>
<form method="post">
    <div id="status-bar">
        <div class="container">
            <div class="row">
                <div class="hidden-xs col-sm-4 vcenter text-center">
                    <span id="paste-directive">Paste A Link Below And Tap “Find It” To Begin!</span>
                </div><!--
                --><div class="col-xs-6 col-sm-4 vcenter text-center">
                    <span id="progress"><span id="num-selected">00</span> of {{ "%02d" % league.preferences.track_count }}</span>
                    <br>
                    <span>Songs Selected</span>
                </div><!--
                --><div class="col-xs-6 col-sm-4 vcenter text-center disabled" id="submit-songs-btn-wrapper">
                    <button type="submit" id="submit-songs-btn" class="btn btn-lg disabled" disabled>Submit Songs!</button>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        {% if previous_tracks %}
            {% set tracks = previous_tracks %}
            <input id="previous-submission" type="hidden" value="{{ tracks }}">
            <input id="duplicate-artists" type="hidden" value="{{ duplicate_artists }}">
            <input id="duplicate-songs" type="hidden" value="{{ duplicate_songs }}">
        {% elif my_submission %}
            {% set tracks = my_submission.tracks %}
        {% else %}
            {% set tracks = [] %}
        {% endif %}

        {% for song_num in range(league.preferences.track_count) %}
        {% set submitted_uri  = tracks[song_num] %}
        {% if submitted_uri and submitted_uri not in duplicate_tracks and submitted_uri not in duplicate_artists %}
        <div class="song row{% if submitted_uri %} found{% endif %}" {% if submitted_uri %}data-uri="{{ submitted_uri }}"{% endif %}>
        {% elif submitted_uri and submitted_uri in duplicate_songs %}
        <div class="song row error duplicate-song">
        {% elif submitted_uri and submitted_uri in duplicate_artists %}
        <div class="song row error duplicate-artist">
        {% else %}
        <div class="song row">
        {% endif %}
            <div class="col-xs-12">
                <div class="col-xs-12">
                    <span class="song-header">Song {{ "%02d" % (song_num + 1) }}</span>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="col-xs-9 col-sm-8">
                    <input type="text" class="form-control find-song-inp" placeholder="Paste Your Spotify Song Link or URI" {% if loop.first %}autofocus="true"{% endif %}>
                </div>
                <div class="col-xs-3 col-sm-4 text-center">
                    <button type="button" class="hidden-xs btn btn-lg find-song-btn">Find It!</button>
                    <button type="button" class="visible-xs btn btn-lg find-song-btn"><span class="search-icon"></span></button>
                </div>
            </div>
            <div class="col-xs-12 song-info">
                <div class="col-xs-12">
                    <span class="you-selected">You Selected:</span>
                </div>
                <div class="col-xs-12">
                    <img src="" alt="" class="img img-rounded">
                    <div class="text-info">
                        <span class="name"></span>
                        <span class="artist"></span>
                        <span class="album"></span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        <input type="hidden" id="songs-inp" name="songs">
    </div>
</form>

{% endblock %}

{% block js %}
<script type="text/javascript" src="/static/js/jquery.sticky-kit.min.js"></script>
<script type="text/javascript" src="/static/js/submit.js"></script>
{% endblock %}
